{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product offered in the Ouro Gráfica marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "shortDescription": {
          "type": "string",
          "description": "A brief description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "basePrice": {
          "type": "number",
          "description": "Base price of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "variations": {
          "type": "array",
          "description": "Array of product variations (e.g., size, quantity).",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "shortDescription",
        "imageUrl",
        "basePrice",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "customerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Current status of the order (e.g., 'Em análise', 'Em produção')."
        },
        "items": {
          "type": "array",
          "description": "List of items in the order, referencing products and their quantities.",
          "items": {
            "type": "string"
          }
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "artworkUrl": {
          "type": "string",
          "description": "URL to the uploaded artwork file (optional).",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "customerId",
        "orderDate",
        "status",
        "items",
        "totalAmount"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "address": {
          "type": "string",
          "description": "Address of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents a single item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.  No denormalized authorization fields are required as products are assumed to be publicly accessible, though access could be restricted to admin roles.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. No denormalized authorization fields are required as categories are assumed to be publicly accessible, though access could be restricted to admin roles.",
          "params": [
            {
              "name": "categoryId",
              "description": "Unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Accessible only to the user and admins.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores orders associated with a specific user. Only the user and admins can access these orders.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/orders_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores order items. No denormalized authorization fields are required assuming items inherit the Order permissions, otherwise authorization data from the parent Order can be denormalized here. NOTE:  This structure can enable complex queries for OrderItems globally (e.g. 'show me the count of OrderItems for Product X').",
          "params": [
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Ouro Gráfica marketplace application, focusing on products, categories, orders, and users. The structure is optimized for security, scalability, and ease of querying, adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling.\n\nAuthorization Independence is achieved by avoiding hierarchical authorization dependencies.  Instead of relying on `get()` calls to parent documents, data necessary for authorization is denormalized into the child documents where needed.  For example, while not explicitly stated as required, if Order items would need different roles depending on the parent Order this could be achieved by denormalizing relevant Order data into the OrderItem.\n\nStructural Segregation is implemented by separating different data types into distinct collections (e.g., `products`, `categories`, `users`, `orders`). This ensures that each collection has a homogeneous security posture and simplifies security rules.  Private user data is stored under `/users/{userId}`, enabling simple path-based ownership rules.\n\nAccess Modeling uses consistent patterns for authorization. User-owned data (orders) are structured using hierarchical paths (`/users/{userId}/orders/{orderId}`), facilitating secure and efficient ownership-based security rules.\n\nThis structure facilitates secure `list` operations by ensuring that rules are not filters (QAPs). Each collection contains data with a uniform access control policy."
  }
}